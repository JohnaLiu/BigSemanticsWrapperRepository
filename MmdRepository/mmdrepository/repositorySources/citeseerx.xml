<meta_metadata_repository name="bib_managing" package="ecologylab.semantics.generated.library.bibManaging" default_user_agent_name="chrome_2">

	<meta_metadata name="citation_info" extends="metadata" comment="Citation numbers.">
		<scalar name="total_citation" scalar_type="Int" />
		<scalar name="self_citation" scalar_type="Int" />
	</meta_metadata>


	<meta_metadata name="citeseerx_record" extends="scholarly_article"
                 comment="CiteSeerX record for an article.">
		<scalar name="title" xpath="//h2" as_natural_id="title" format="text">
			<filter regex="(\(.*\))|(\[.*\])" replace="" />
		</scalar>
		
		<collection name="authors" xpath="//div[@id='docAuthors']">
			<field_parser name="regex_split" regex="\s*,\s*" />
			<scalar name="title" field_parser_key="$0">
				<filter regex="^by\s+" replace="" />
			</scalar>
		</collection>
		
		<composite name="citation_info" type="citation_info" xpath="//a[@title='number of citations']">
			<field_parser name="regex_find" regex="(\d+) - (\d+) self" />
			<scalar name="total_citation" field_parser_key="$1" />
			<scalar name="self_citation" field_parser_key="$2" />
		</composite>
		
		<composite name="rich_media">
		  <scalar name="title">
		    <concatenate_values>
		      <value>PDF</value>
		    </concatenate_values>
		  </scalar>
		  <scalar name="location" xpath="//div[@id='downloads']//a[@title='View or Download this document as PDF']/@href" />
		</composite>
	</meta_metadata>


	<meta_metadata name="citeseerx_summary" extends="citeseerx_record" parser="xpath"
                 comment="Summary page from CiteSeerX.">
		<selector url_stripped="http://citeseerx.ist.psu.edu/viewdoc/summary" />
		<example_url url="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.167.1350" />
    
    <url_generator type="search" engine="citeseerx" use_id="title" />
    
		<composite name="source" xpath="//div[@id='viewSidebar']//p">
			<field_parser name="bibtex" />
			<composite name="archive" >
				<scalar name="title" field_parser_key="booktitle|journal" />
			</composite>
			<scalar name="year" field_parser_key="year" />
			<scalar name="isbn" field_parser_key="isbn" />
		</composite>

		<scalar name="description" xpath="//div[@id='abstract']/p" />
		
    <!-- CiteSeerX web page says these are citations, but actually they are references! -->
		<collection name="references" xpath="//h3[text()='Citations']/../table//a">
			<scalar name="title" xpath=".." />
			<scalar name="location" xpath="./@href">
				<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
			</scalar>
		</collection>

    <composite name="citation_records" type="document" xpath="//a[@title='number of citations']">
      <scalar name="title" xpath="." navigates_to="location" />
      <scalar name="location" xpath="./@href" hide="true">
  			<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
      </scalar>
    </composite>
    <composite name="active_bibliography_records" type="document" xpath="//a[@title='Documents that cite the same works']">
      <scalar name="title" xpath="./@title" navigates_to="location" />
      <scalar name="location" xpath="./@href" hide="true">
  			<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
      </scalar>
    </composite>
    <composite name="cocitation_records" type="document" xpath="//a[@title='Documents cited by the same works']">
      <scalar name="title" xpath="./@title" navigates_to="location" />
      <scalar name="location" xpath="./@href" hide="true">
  			<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
      </scalar>
    </composite>

		<semantic_actions>
			<get_field name="location" />
			<if>
				<not_null value="location" />
				<parse_document now="true">
					<arg value="metadata" name="document" />
					<arg value="location" name="location" />
				</parse_document>
			</if>

			<get_field name="title" />
			<create_and_visualize_text_surrogate>
				<arg value="title" name="text" />
			</create_and_visualize_text_surrogate>

			<get_field name="references" />
			<if>
				<not_null value="references" />
				<for_each collection="references" as="ref">
					<get_field object="ref" name="description" />
					<parse_document>
						<arg value="true" name="citation_sig" />
						<arg value="description" name="anchor_text" />
						<arg value="ref" name="entity" />
					</parse_document>
				</for_each>
			</if>
		</semantic_actions>
	</meta_metadata>


	<meta_metadata name="citeseerx_similar" type="citeseerx_record" parser="xpath"
                 comment="Citation or co-citation page from CiteSeerX.">
		<selector url_stripped="http://citeseerx.ist.psu.edu/viewdoc/similar" />
		<example_url url="http://citeseerx.ist.psu.edu/viewdoc/similar?doi=10.1.1.167.1350&amp;type=sc" />

		<collection name="citations" xpath="//table[@class='citelist']//a">
			<scalar name="location" xpath="./@href">
				<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
			</scalar>
			<scalar name="description" xpath=".." />
		</collection>

		<semantic_actions>
			<get_field name="citations" />
			<if>
				<not_null value="citations" />
				<for_each collection="citations" as="cite">
					<get_field object="cite" name="description" />
					<parse_document>
						<arg value="true" name="citation_sig" />
						<arg value="description" name="anchor_text" />
						<arg value="cite" name="entity" />
					</parse_document>
				</for_each>
			</if>
		</semantic_actions>
	</meta_metadata>


	<meta_metadata name="citeseerx_search_result" extends="document">
		<scalar name="citation_info" scalar_type="String" />
	</meta_metadata>

	<meta_metadata name="citeseerx_search" extends="search" parser="xpath"
                 comment="CiteSeerX search using keywords.">
    <generic_type_var name="SR" arg="citeseerx_search_result" />
    
		<selector url_stripped="http://citeseerx.ist.psu.edu/search" />
		<example_url url="http://citeseerx.ist.psu.edu/search?q=pad+zooming+graphical+interface&amp;submit=Search&amp;sort=rlv&amp;t=doc" />

		<collection name="search_results" xpath="//div[@id='result_list']/div[@class='result']">
			<scalar name="title" xpath=".//h3" />
			<scalar name="description" xpath=".//div[@class='snippet']" />
			<scalar name="location" xpath=".//h3/a/@href">
				<filter regex=";jsessionid=[A-Za-z0-9]*" replace="" />
			</scalar>
			<scalar name="citation_info" xpath=".//a[@title='number of citations']" />
		</collection>

		<semantic_actions>
			<get_field name="search_results" />
			<for_each collection="search_results" as="res">
				<get_field name="location" object="res" />
				<parse_document now="true">
					<arg name="location" value="location" />
				</parse_document>
			</for_each>
		</semantic_actions>
	</meta_metadata>


	<meta_metadata name="citeseerx_citing" type="citeseerx_search" parser="xpath"
                 comment="CiteSeerX citing results.">
		<selector url_stripped="http://citeseerx.ist.psu.edu/showciting" />

		<semantic_actions>
			<get_field name="search_results" />
			<for_each collection="search_results" as="res">
				<get_field name="location" object="res" />
				<parse_document>
					<arg name="location" value="location" />
				</parse_document>
			</for_each>
		</semantic_actions>
	</meta_metadata>

</meta_metadata_repository>
