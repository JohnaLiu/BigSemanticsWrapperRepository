<?xml version="1.0" encoding="UTF-8"?>
<meta_metadata_repository name="urbanSpoon"
                          package="ecologylab.bigsemantics.generated.library.urbanspoon"
                          default_user_agent_name="firefox">
	
	<meta_metadata name="urban_spoon_restaurant" type="restaurant" parser="xpath"
                 comment="UrbanSpoon restaurant description page.">
		<selector url_path_tree="http://www.urbanspoon.com/r" />
		<example_url url="http://www.urbanspoon.com/r/114/875031/restaurant/College-Station/Christophers-World-Grill-Bryan" />
		
		<def_var name="main_block" type="node" xpath="//div[@id='directory']" />
		<def_var name="resto_details" type="node" xpath="//div[@class='resto_details']" />
		<def_var name="address" type="node" xpath="//div[@class='address']" />
		
		<scalar name="title" xpath="//h1[@class='page_title']" />
		<composite name="image" >
			<scalar name="location" xpath="//div[@class='resto_photos']//ul//li[1]//img/@src" />
		</composite>
	    <scalar name="overall_rating" xpath="//div[@class='average digits percent-text rating']" />
<!-- 		<composite name="business_website"> -->
<!-- 			<scalar name="location" context_node="primary" -->
<!--               xpath="./p[@class='website']/a[@class='ext']/@href" /> -->
<!-- 		</composite> -->
		<scalar name="num_reviews" context_node="resto_details" xpath="//span[@class='posts_count']" /> 
		<collection name="reviews" xpath="//div[@id='restaurant_opinions']/ul/li">
			<scalar name="title" xpath="//div[@class='content']/div[@class='title']" />
			<scalar name="description" xpath="//div[@class='content']//div[@class='body']" />
		</collection>
		
		<composite name="business_address">
			<scalar name="telephone" context_node="resto_details" xpath="./h3" />
			<scalar name="street_address" context_node="address" xpath=".//span[@class='street-address']" />
			<scalar name="locality" context_node="address" xpath=".//span[@class='locality']" />
			<scalar name="postal_code" context_node="address" xpath=".//a[@class='postal-code']" />
			<scalar name="region" context_node="address" xpath=".//span[@class='region']" />
			<scalar name="location" >
				<concatenate_values>
					<value>http://maps.google.com/maps?q=</value>
					<value from_scalar="street_address" />
					<value>,</value>
					<value from_scalar="postal_code" />
	 			</concatenate_values>
	 		</scalar>
		</composite>
		
		<scalar name="price_range" context_node="resto_details" xpath=".//span[@class='price']" />
		<collection name="genres" context_node="resto_details" xpath="./a">
			<scalar name="title" xpath="." />
			<scalar name="description" xpath="./@href" />
			<scalar name="location" >
			<concatenate_values>
				<value>http://www.urbanspoon.com</value>
				<value from_scalar="description" />
 			</concatenate_values>
			</scalar>
		</collection>
	</meta_metadata>


	<meta_metadata name="urban_spoon_genre" type="restaurant_genre" parser="xpath">
		<selector url_path_tree="http://www.urbanspoon.com/f"/>
		<example_url url="http://www.urbanspoon.com/f/114/11800/College-Station/American-Restaurants" />
		
		<scalar name="title" xpath="/html/head/title"/>
		<collection name="restaurants" xpath="//li[@class='row restaurant']//div[@class='title']/a" >
			<scalar name="location" xpath="./@href" />
			<scalar name="title" xpath="." />
		</collection>
	</meta_metadata>
	
  
	<meta_metadata name="urban_spoon_search" type="search" parser="xpath">
		<selector name="spoon1" url_path_tree="http://www.urbanspoon.com/s/" />
    
		<collection name="search_results" child_type="document"
                xpath="//div[@class = 't']/a[text() != '']">
			<scalar name="title" xpath="." />
			<scalar name="location" xpath="./@href" />
		</collection>
    
		<semantic_actions>
			<get_field name="search_results" />
			<for_each collection="search_results" as="res">
				<get_field object="res" name="location" />
				<get_field object="res" name="title" />
				<parse_document>
					<arg value="title" name="anchor_text" />
					<arg value="location" name="location" />
				</parse_document>
			</for_each>
		</semantic_actions>
	</meta_metadata>

</meta_metadata_repository>